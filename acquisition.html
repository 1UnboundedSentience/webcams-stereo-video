<!DOCTYPE html>
<html>
<head>
	<title>Acquisition</title>
	<style>
		video {
			outline: 1px solid red;
			min-width: 320px;
			min-height: 240px;
			display: inline-block;
			margin: 15px;
		}
		textarea {
			display: block;
			height: 200px;
			width: 750px;
		}
	</style>
</head>
<body>

<div>
	<button id="start">Start acquisition</button>
	<button id="stop">Stop acquisition</button>
	<textarea id="sources-log"></textarea>
</div>

<video id="video0" autoplay></video>
<video id="video1" autoplay></video>

<script>
// (function() {
	navigator.getUserMedia = navigator.getUserMedia ||
	                         navigator.webkitGetUserMedia ||
	                         navigator.mozGetUserMedia;
	if (!navigator.getUserMedia) {
		throw new Error("getUserMedia not supported");
	}

	var sourcesLog = document.getElementById('sources-log'),
		startEl = document.getElementById('start'),
		stopEl = document.getElementById('stop'),
		videos = [
			document.getElementById('video0'),
			document.getElementById('video1')
		],
		streams = []
		videoSources = [],
		constraints = [];

	function init() {
		if (typeof MediaStreamTrack === 'undefined' ||
		    typeof MediaStreamTrack.getSources === 'undefined') {
		  alert('This browser does not support MediaStreamTrack.\n\nTry Chrome.');
		} else {
		  MediaStreamTrack.getSources(gotSources);
		}
		startEl.addEventListener('click', startAcquisition);
		stopEl.addEventListener('click', stopAcquisition);
	}

	function startAcquisition() {
		videos.forEach(function(video, index) {
		   navigator.getUserMedia(constraints[index],
		      function(stream) {
		         video.src = window.URL.createObjectURL(stream);
		         streams[index] = stream;
		      },
		      function(err) {
		         console.log("The following error occured: " + err.name);
		      }
		   );
		});
	}

	function stopAcquisition() {
		streams.forEach(function(stream) {
			stream.stop();
		});
	}

	function gotSources(sourceInfos) {
	  for (var i = 0; i !== sourceInfos.length; ++i) {
	    var sourceInfo = sourceInfos[i];
	    var output = [];
	    output.push('id: '+ sourceInfo.id);
    	output.push('kind: '+ sourceInfo.kind);
    	output.push('label: '+ sourceInfo.label);
	    if (sourceInfo.kind === 'video') {
	      videoSources.push(sourceInfo.id)
	    }
	    sourcesLog.value += output.join(' - ') + '\n';
	  }
		constraints = [{
		  video: {
		    mandatory: {
		      minWidth: 320,
		      minHeight: 240,
		      minFrameRate: 30,
		      sourceId: videoSources[0]
		    },
		    optional: [
		      { minFrameRate: 60 }
		    ]
		  },
		  audio: false
		}, {
		  video: {
		    mandatory: {
		      minWidth: 320,
		      minHeight: 240,
		      minFrameRate: 30,
		      sourceId: videoSources[1]
		    },
		    optional: [
		      { minFrameRate: 60 }
		    ]
		  },
		  audio: false
		}];
	}

	init();
// })();
</script>

</body>
</html>